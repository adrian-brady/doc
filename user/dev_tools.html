  <!DOCTYPE html>
  <html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Neovim user documentation">

    <link href="help.css" rel="stylesheet">
    <title> Dev_tools - Neovim docs</title>
  </head>
  <body>
    <header class="container">
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a href="index.html" class="navbar-brand" aria-label="logo">
          <!--TODO: use <img src="â€¦.svg"> here instead. Need one that has green lettering instead of gray. -->
              <svg xmlns="http://www.w3.org/2000/svg" role="img" width="173" height="50" viewBox="0 0 742 214" aria-label="Neovim">
      <title>Neovim</title>
      <defs>
        <linearGradient x1="50%" y1="0%" x2="50%" y2="100%" id="a">
          <stop stop-color="#16B0ED" stop-opacity=".8" offset="0%" />
          <stop stop-color="#0F59B2" stop-opacity=".837" offset="100%" />
        </linearGradient>
        <linearGradient x1="50%" y1="0%" x2="50%" y2="100%" id="b">
          <stop stop-color="#7DB643" offset="0%" />
          <stop stop-color="#367533" offset="100%" />
        </linearGradient>
        <linearGradient x1="50%" y1="0%" x2="50%" y2="100%" id="c">
          <stop stop-color="#88C649" stop-opacity=".8" offset="0%" />
          <stop stop-color="#439240" stop-opacity=".84" offset="100%" />
        </linearGradient>
      </defs>
      <g fill="none" fill-rule="evenodd">
        <path
          d="M.027 45.459L45.224-.173v212.171L.027 166.894V45.459z"
          fill="url(#a)"
          transform="translate(1 1)"
        />
        <path
          d="M129.337 45.89L175.152-.149l-.928 212.146-45.197-45.104.31-121.005z"
          fill="url(#b)"
          transform="matrix(-1 0 0 1 305 1)"
        />
        <path
          d="M45.194-.137L162.7 179.173l-32.882 32.881L12.25 33.141 45.194-.137z"
          fill="url(#c)"
          transform="translate(1 1)"
        />
        <path
          d="M46.234 84.032l-.063 7.063-36.28-53.563 3.36-3.422 32.983 49.922z"
          fill-opacity=".13"
          fill="#000"
        />
        <g fill="#444">
          <path
            d="M227 154V64.44h4.655c1.55 0 2.445.75 2.685 2.25l.806 13.502c4.058-5.16 8.786-9.316 14.188-12.466 5.4-3.15 11.413-4.726 18.037-4.726 4.893 0 9.205.781 12.935 2.34 3.729 1.561 6.817 3.811 9.264 6.751 2.448 2.942 4.297 6.48 5.55 10.621 1.253 4.14 1.88 8.821 1.88 14.042V154h-8.504V96.754c0-8.402-1.91-14.987-5.729-19.757-3.82-4.771-9.667-7.156-17.544-7.156-5.851 0-11.28 1.516-16.292 4.545-5.013 3.032-9.489 7.187-13.427 12.467V154H227zM350.624 63c5.066 0 9.755.868 14.069 2.605 4.312 1.738 8.052 4.268 11.219 7.592s5.638 7.412 7.419 12.264C385.11 90.313 386 95.883 386 102.17c0 1.318-.195 2.216-.588 2.696-.393.48-1.01.719-1.851.719h-64.966v1.70c0 6.708.784 12.609 2.353 17.7 1.567 5.09 3.8 9.357 6.695 12.802 2.895 3.445 6.393 6.034 10.495 7.771 4.1 1.738 8.686 2.606 13.752 2.606 4.524 0 8.446-.494 11.762-1.483 3.317-.988 6.108-2.097 8.37-3.324 2.261-1.227 4.056-2.336 5.383-3.324 1.326-.988 2.292-1.482 2.895-1.482.784 0 1.388.3 1.81.898l2.352 2.875c-1.448 1.797-3.362 3.475-5.745 5.031-2.383 1.558-5.038 2.891-7.962 3.998-2.926 1.109-6.062 1.991-9.41 2.65a52.21 52.21 0 01-10.088.989c-6.152 0-11.762-1.064-16.828-3.19-5.067-2.125-9.415-5.225-13.043-9.298-3.63-4.074-6.435-9.06-8.415-14.96C310.99 121.655 310 114.9 310 107.294c0-6.408.92-12.323 2.76-17.744 1.84-5.421 4.493-10.093 7.961-14.016 3.467-3.922 7.72-6.991 12.758-9.209C338.513 64.11 344.229 63 350.624 63zm.573 6c-4.696 0-8.904.702-12.623 2.105-3.721 1.404-6.936 3.421-9.65 6.053-2.713 2.631-4.908 5.79-6.586 9.474S319.55 94.439 319 99h60c0-4.679-.672-8.874-2.013-12.588-1.343-3.712-3.232-6.856-5.67-9.43-2.44-2.571-5.367-4.545-8.782-5.92-3.413-1.374-7.192-2.062-11.338-2.062zM435.546 63c6.526 0 12.368 1.093 17.524 3.28 5.154 2.186 9.5 5.286 13.04 9.298 3.538 4.013 6.238 8.85 8.099 14.51 1.861 5.66 2.791 11.994 2.791 19.002 0 7.008-.932 13.327-2.791 18.957-1.861 5.631-4.561 10.452-8.099 14.465-3.54 4.012-7.886 7.097-13.04 9.254-5.156 2.156-10.998 3.234-17.524 3.234-6.529 0-12.369-1.078-17.525-3.234-5.155-2.157-9.517-5.242-13.085-9.254-3.57-4.013-6.285-8.836-8.145-14.465-1.861-5.63-2.791-11.95-2.791-18.957 0-7.008.93-13.342 2.791-19.002 1.861-5.66 4.576-10.496 8.145-14.51 3.568-4.012 7.93-7.112 13.085-9.299C423.177 64.094 429.017 63 435.546 63zm-.501 86c5.341 0 10.006-.918 13.997-2.757 3.99-1.838 7.32-4.474 9.992-7.909 2.67-3.435 4.664-7.576 5.986-12.428 1.317-4.85 1.98-10.288 1.98-16.316 0-5.965-.66-11.389-1.98-16.27-1.322-4.88-3.316-9.053-5.986-12.519-2.67-3.463-6-6.13-9.992-7.999-3.991-1.867-8.657-2.802-13.997-2.802s-10.008.935-13.997 2.802c-3.991 1.87-7.322 4.536-9.992 8-2.671 3.465-4.68 7.637-6.03 12.518-1.35 4.881-2.026 10.305-2.026 16.27 0 6.026.675 11.465 2.025 16.316 1.35 4.852 3.36 8.993 6.031 12.428 2.67 3.435 6 6.07 9.992 7.91 3.99 1.838 8.656 2.756 13.997 2.756z"
            fill="currentColor"
          />
          <path
            d="M530.57 152h-20.05L474 60h18.35c1.61 0 2.967.39 4.072 1.166 1.103.778 1.865 1.763 2.283 2.959l17.722 49.138a92.762 92.762 0 012.551 8.429c.686 2.751 1.298 5.5 1.835 8.25.537-2.75 1.148-5.499 1.835-8.25a77.713 77.713 0 012.64-8.429l18.171-49.138c.417-1.196 1.164-2.181 2.238-2.96 1.074-.776 2.356-1.165 3.849-1.165H567l-36.43 92zM572 61h23v92h-23zM610 153V60.443h13.624c2.887 0 4.78 1.354 5.682 4.06l1.443 6.856a52.7 52.7 0 015.097-4.962 32.732 32.732 0 015.683-3.879 30.731 30.731 0 016.496-2.57c2.314-.632 4.855-.948 7.624-.948 5.832 0 10.63 1.579 14.39 4.736 3.758 3.157 6.57 7.352 8.434 12.585 1.444-3.068 3.248-5.698 5.413-7.894 2.165-2.194 4.541-3.984 7.127-5.367a32.848 32.848 0 018.254-3.068 39.597 39.597 0 018.796-.992c5.111 0 9.653.783 13.622 2.345 3.97 1.565 7.307 3.849 10.014 6.857 2.706 3.007 4.766 6.675 6.18 11.005C739.29 83.537 740 88.5 740 94.092V153h-22.284V94.092c0-5.894-1.294-10.329-3.878-13.306-2.587-2.977-6.376-4.465-11.368-4.465-2.286 0-4.404.391-6.358 1.172a15.189 15.189 0 00-5.144 3.383c-1.473 1.474-2.631 3.324-3.474 5.548-.842 2.225-1.263 4.781-1.263 7.668V153h-22.37V94.092c0-6.194-1.249-10.704-3.744-13.532-2.497-2.825-6.18-4.24-11.051-4.24-3.19 0-6.18.798-8.976 2.391-2.799 1.593-5.399 3.775-7.804 6.54V153H610zM572 30h23v19h-23z"
            fill="currentColor"
            fill-opacity=".8"
          />
        </g>
      </g>
    </svg>
  
          <!--<img src="https://neovim.io/logos/neovim-logo.svg" width="173" height="50" alt="Neovim" />-->
        </a>
      </div>
    </nav>
  </header>

  <div class="container golden-grid help-body">
  <div class="col-wide">
  <a name="dev_tools.txt" href="#dev-tools"><h1 id="dev-tools"> Dev_tools</h1></a>
  <p>
    <i>
    Nvim <code>:help</code> pages, <a href="https://github.com/neovim/neovim/blob/master/src/gen/gen_help_html.lua">generated</a>
    from <a href="https://github.com/neovim/neovim/blob/master/runtime/doc/dev_tools.txt">source</a>
    using the <a href="https://github.com/neovim/tree-sitter-vimdoc">tree-sitter-vimdoc</a> parser.
    </i>
  </p>
  <hr/>
  <div class="help-para">
Tools and techniques for developing Nvim

</div>
<div class="help-para">
This is for developing or debugging Nvim itself.

</div>
<div class="help-para">
<h2 id="_logs" class="help-heading">Logs<span class="help-heading-tags">                                                          <span id="dev-tools-logs" class="help-tag"><a href="#dev-tools-logs">dev-tools-logs</a></span></h2>


</div>
<div class="help-para">
Low-level log messages sink to <code>$NVIM_LOG_FILE</code>.

</div>
<div class="help-para">
UI events are logged at DEBUG level.<pre>rm -rf build/
make CMAKE_EXTRA_FLAGS="-DLOG_DEBUG"</pre>
Use <code>LOG_CALLSTACK()</code> (Linux only) to log the current stacktrace. To log to an
alternate file (e.g. stderr) use <code>LOG_CALLSTACK_TO_FILE(FILE*)</code>. Requires
<code>-no-pie</code> ([ref](<a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=860394#15">https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=860394#15</a>)):<pre>rm -rf build/
make CMAKE_EXTRA_FLAGS="-DLOG_DEBUG -DCMAKE_C_FLAGS=-no-pie"</pre>
Many log messages have a shared prefix, such as "UI" or "RPC". Use the shell to
filter the log, e.g. at DEBUG level you might want to exclude UI messages:<pre>tail -F ~/.local/state/nvim/log | cat -v | stdbuf -o0 grep -v UI | stdbuf -o0 tee -a log</pre>
<h2 id="_reproducible-build" class="help-heading">Reproducible build</h2>


</div>
<div class="help-para">
To make a reproducible build of Nvim, set cmake variable <code>LUA_GEN_PRG</code> to
a LuaJIT binary built with <code>LUAJIT_SECURITY_PRN=0</code>. See commit
cb757f2663e6950e655c6306d713338dfa66b18d.

</div>
<div class="help-para">
<h2 id="_debug-tui" class="help-heading">Debug TUI<span class="help-heading-tags">                                                      <span id="dev-tools-tui" class="help-tag"><a href="#dev-tools-tui">dev-tools-tui</a></span></h2>


</div>
<div class="help-para">
<h3 id="_tui-inspect" class="help-heading">TUI INSPECT</h3>


</div>
<div class="help-para">
Use the Ghostty <a href="https://ghostty.org/">https://ghostty.org/</a> inspector tool to observe and query the
output and events from any terminal application such as Nvim.

</div>
<div class="help-para">
<h3 id="_terminfo-logging" class="help-heading">TERMINFO LOGGING</h3>


</div>
<div class="help-para">
At <a href="options.html#'verbose'">'verbose'</a> level 3, Nvim logs its internal terminfo state, so you can see
exactly what terminfo values it is using on the current system.<pre>nvim -V3log</pre>
<h3 id="_tui-debugging-with-gdb-lldb" class="help-heading">TUI DEBUGGING WITH GDB LLDB</h3>


</div>
<div class="help-para">
Launching the Nvim TUI involves two processes, one for main editor state and one
for rendering the TUI. Both of these processes use the nvim binary, so somewhat
confusingly setting a breakpoint in either will generally succeed but may not be
hit depending on which process the breakpoints were set in.

</div>
<div class="help-para">
To debug the main process, you can debug the nvim binary with the <code>--headless</code>
flag which does not launch the TUI and will allow you to set breakpoints in code
not related to TUI rendering like so:<pre>lldb -- ./build/bin/nvim --headless --listen ~/.cache/nvim/debug-server.pipe</pre>
While in lldb, enter <code>run</code>. You can then attach to the headless process in a
new terminal window to interact with the editor like so:<pre>./build/bin/nvim --remote-ui --server ~/.cache/nvim/debug-server.pipe</pre>
Conversely for debugging TUI rendering, you can start a headless process and
debug the remote-ui process multiple times without losing editor state.

</div>
<div class="help-para">
For details on using nvim-dap and automatically debugging the child (main)
process, see [here](<a href="https://zignar.net/2023/02/17/debugging-neovim-with-neovim-and-nvim-dap/">https://zignar.net/2023/02/17/debugging-neovim-with-neovim-and-nvim-dap/</a>)

</div>
<div class="help-para">
<h3 id="_tui-redraw" class="help-heading">TUI REDRAW</h3>


</div>
<div class="help-para">
For debugging Nvim TUI redraw behavior it is sometimes useful to slow down its
redraws. Set the <a href="options.html#'writedelay'">'writedelay'</a> and <a href="options.html#'redrawdebug'">'redrawdebug'</a> options to see where and when
the UI is painted.<pre>:set writedelay=50 rdb=compositor</pre>
<b>Note:</b> Nvim uses an internal screenbuffer to only send minimal updates even if a large
region is repainted internally. To also highlight excess internal redraws, use<pre>:set writedelay=50 rdb=compositor,nodelta</pre>
<h3 id="_tui-trace" class="help-heading">TUI TRACE</h3>


</div>
<div class="help-para">
In the rare case that you want to collect a trace of terminal output, the
ancient <code>script</code> command is still the "state of the art". The libvterm
<code>vterm-dump</code> utility formats the result for human-readability.

</div>
<div class="help-para">
Record a Nvim terminal session and format it with <code>vterm-dump</code>:<pre><code class="language-sh">script foo
./build/bin/nvim -u NONE
# Exit the script session with CTRL-d
# Use `vterm-dump` utility to format the result.
./.deps/usr/bin/vterm-dump foo &gt; bar</code></pre>
Then you can compare <code>bar</code> with another session, to debug TUI behavior.

</div>
<div class="help-para">
<h3 id="_terminal-reference" class="help-heading">TERMINAL REFERENCE</h3>


</div>
<div class="help-para">
<div class="help-li" style=""> <code>man terminfo</code>
</div><div class="help-li" style=""> <a href="https://github.com/vim/vim/blob/0124320c97b0fbbb44613f42fc1c34fee6181fc8/src/libvterm/doc/seqs.txt">https://github.com/vim/vim/blob/0124320c97b0fbbb44613f42fc1c34fee6181fc8/src/libvterm/doc/seqs.txt</a>
</div><div class="help-li" style=""> <a href="https://invisible-island.net/xterm/ctlseqs/ctlseqs.html">https://invisible-island.net/xterm/ctlseqs/ctlseqs.html</a>
</div>
</div>
<div class="help-para">
<h2 id="_debug-performance" class="help-heading">Debug Performance<span class="help-heading-tags">                                             <span id="dev-tools-perf" class="help-tag"><a href="#dev-tools-perf">dev-tools-perf</a></span></h2>


</div>
<div class="help-para">
<h3 id="_profiling-(easy)" class="help-heading">PROFILING (EASY)</h3>


</div>
<div class="help-para">
For debugging performance bottlenecks in any code, there is a simple (and very
effective) approach:

</div>
<div class="help-para">
1. Run the slow code in a loop.
2. Break execution ~5 times and save the stacktrace.
3. The cause of the bottleneck will (almost always) appear in most of the stacktraces.

</div>
<div class="help-para">
<h3 id="_profiling-(fancy)" class="help-heading">PROFILING (FANCY)</h3>


</div>
<div class="help-para">
For more advanced profiling, consider <code>perf</code> + <code>flamegraph</code>.

</div>
<div class="help-para">
<h3 id="_usdt-profiling-(powerful)" class="help-heading">USDT PROFILING (POWERFUL)</h3>


</div>
<div class="help-para">
Or you can use USDT probes via <code>NVIM_PROBE</code> ([#12036](<a href="https://github.com/neovim/neovim/pull/12036">https://github.com/neovim/neovim/pull/12036</a>)).

</div>
<div class="help-para">
&gt; USDT is basically a way to define stable probe points in userland binaries.
&gt; The benefit of bcc is the ability to define logic to go along with the probe
&gt; points.

</div>
<div class="help-para">
Tools:
<div class="help-li" style=""> bpftrace provides an awk-like language to the kernel bytecode, BPF.
</div><div class="help-li" style=""> BCC provides a subset of C. Provides more complex logic than bpftrace, but takes a bit more effort.
</div>
</div>
<div class="help-para">
Example using bpftrace to track slow vim functions, and print out any files
that were opened during the trace. At the end, it prints a histogram of
function timing:<pre>#!/usr/bin/env bpftrace
BEGIN {
  @depth = -1;
}
tracepoint:sched:sched_process_fork /@pidmap[args-&gt;parent_pid]/ {
  @pidmap[args-&gt;child_pid] = 1;
}
tracepoint:sched:sched_process_exit /@pidmap[args-&gt;pid]/ {
  delete(@pidmap[args-&gt;pid]);
}
usdt:build/bin/nvim:neovim:eval__call_func__entry {
    @pidmap[pid] = 1;
    @depth++;
    @funcentry[@depth] = nsecs;
}
usdt:build/bin/nvim:neovim:eval__call_func__return {
    $func = str(arg0);
    $msecs = (nsecs - @funcentry[@depth]) / 1000000;
    @time_histo = hist($msecs);
    if ($msecs &gt;= 1000) {
      printf("%u ms for %s\n", $msecs, $func);
      print(@files);
    }
    clear(@files);
    delete(@funcentry[@depth]);
    @depth--;
}
tracepoint:syscalls:sys_enter_open,
tracepoint:syscalls:sys_enter_openat {
  if (@pidmap[pid] == 1 &amp;&amp; @depth &gt;= 0) {
    @files[str(args-&gt;filename)] = count();
  }
}
END {
  clear(@depth);
}
$ sudo bpftrace funcslower.bt
1527 ms for Slower
@files[/usr/lib/libstdc++.so.6]: 2
@files[/etc/fish/config.fish]: 2
&lt;snip&gt;
^C
@time_histo:
[0]                71430 |@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@|
[1]                  346 |                                                    |
[2, 4)               208 |                                                    |
[4, 8)                91 |                                                    |
[8, 16)               22 |                                                    |
[16, 32)              85 |                                                    |
[32, 64)               7 |                                                    |
[64, 128)              0 |                                                    |
[128, 256)             0 |                                                    |
[256, 512)             6 |                                                    |
[512, 1K)              1 |                                                    |
[1K, 2K)               5 |                                                    |</pre>

</div>
<div class="help-para">
<h2 id="_backtraces" class="help-heading">Backtraces<span class="help-heading-tags">                                               <span id="dev-tools-backtrace" class="help-tag"><a href="#dev-tools-backtrace">dev-tools-backtrace</a></span></h2>


</div>
<div class="help-para">
<h3 id="_linux" class="help-heading">LINUX</h3>


</div>
<div class="help-para">
Core dumps are disabled by default on Ubuntu, CentOS and others.
To enable core dumps:
<pre><code class="language-bash">ulimit -c unlimited</code></pre>

</div>
<div class="help-para">
On systemd-based systems getting a backtrace is as easy as:
<pre><code class="language-bash">coredumpctl -1 gdb</code></pre>

</div>
<div class="help-para">
<code>coredumpctl</code> is an optional tool, so you may need to install it:
<pre><code class="language-bash">sudo apt install systemd-coredump</code></pre>

</div>
<div class="help-para">
The full backtrace is most useful; please send us the <code>backtrace.txt</code> file
when reporting a bug related to a crash:
<pre><code class="language-bash">2&gt;&amp;1 coredumpctl -1 gdb | tee -a backtrace.txt
(gdb) thread apply all bt full</code></pre>

</div>
<div class="help-para">
On systems without <code>coredumpctl</code>, you may find a <code>core</code> dump file appearing
in the current directory or in other locations. On Linux systems where
<code>apport</code> is installed (such as Ubuntu), the directory where core dump files
are saved can be <code>/var/lib/apport/coredump</code> or elsewhere, depending on the
system configuration (see <code>/proc/sys/kernel/core_pattern</code>). See also:
<a href="https://stackoverflow.com/a/18368068">https://stackoverflow.com/a/18368068</a>

</div>
<div class="help-para">
To get a backtrace from the <code>./core</code> dump file:
<pre><code class="language-bash">gdb build/bin/nvim ./core 2&gt;&amp;1 | tee backtrace.txt
(gdb) thread apply all bt full</code></pre>

</div>
<div class="help-para">
<h3 id="_macos" class="help-heading">MACOS</h3>


</div>
<div class="help-para">
If <code>nvim</code> crashes, you can see the backtrace in <code>Console.app</code> (under "Crash
Reports" or "User Diagnostic Reports" for older macOS versions).
<pre><code class="language-bash">open -a Console</code></pre>

</div>
<div class="help-para">
You may also want to enable core dumps on macOS. To do this, first make sure
the <code>/cores/</code> directory exists and is writable:
<pre><code class="language-bash">sudo mkdir /cores
sudo chown root:admin /cores
sudo chmod 1775 /cores</code></pre>

</div>
<div class="help-para">
Then set the core size limit to <code>unlimited</code>:
<pre><code class="language-bash">ulimit -c unlimited</code></pre>

</div>
<div class="help-para">
Note that this is done per shell process. If you want to make this the default
for all shells, add the above line to your shell's init file (e.g. <code>~/.bashrc</code>
or similar).

</div>
<div class="help-para">
You can then open the core file in <code>lldb</code>:
<pre><code class="language-bash">lldb -c /cores/core.12345</code></pre>

</div>
<div class="help-para">
Apple's documentation archive has some other useful information
<a href="https://developer.apple.com/library/archive/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS,">https://developer.apple.com/library/archive/technotes/tn2124/_index.html#//apple_ref/doc/uid/DTS10003391-CH1-SECCOREDUMPS,</a>
but note that some of the things on this page are out of date (such as enabling
core dumps with <code>/etc/launchd.conf</code>).

</div>
<div class="help-para">
<h3 id="_windows" class="help-heading">WINDOWS</h3>


</div>
<div class="help-para">
If the Windows version of Nvim crashes in a reproducible manner, you can take
some steps to provide a useful bug report.

</div>
<div class="help-para">
You must obtain the debugger symbols (PDB) file for the Nvim executable: nvim.pdb.
The PDB should be available from the same place that you obtained the
executable (TODO: not currently provided by Nvim CI releases).  Be sure to use
the PDB that matches the EXE (same build).

</div>
<div class="help-para">
If you built the executable yourself with the Microsoft Visual C++ compiler,
then the PDB was built with the EXE.

</div>
<div class="help-para">
If you have Visual Studio, use that instead of the VC Toolkit and WinDbg.

</div>
<div class="help-para">
For other compilers, always use the corresponding debugger: gdb or lldb.

</div>
<div class="help-para">
<div class="help-column_heading">Debugging Nvim crashes with Visual Studio 2005</div>

</div>
<div class="help-para">
First launch nvim.exe and then launch Visual Studio.  (If you don't have
Visual Studio, get it from <a href="https://visualstudio.microsoft.com/downloads/">https://visualstudio.microsoft.com/downloads/</a>).

</div>
<div class="help-para">
On the Tools menu, click Attach to Process.  Choose the Nvim process.

</div>
<div class="help-para">
In Nvim, reproduce the crash.  A dialog will appear in Visual Studio, telling
you about the unhandled exception in the Nvim process.  Click Break to break
into the process.

</div>
<div class="help-para">
Visual Studio will pop up another dialog, telling you that no symbols are
loaded and that the source code cannot be displayed.  Click OK.

</div>
<div class="help-para">
Several windows will open.  Right-click in the Call Stack window.  Choose Load
Symbols.  The Find Symbols dialog will open, looking for (g)vim.pdb.  Navigate
to the directory where you have the PDB file and click Open.

</div>
<div class="help-para">
At this point, you should have a full call stack with vim function names and
line numbers.  Double-click one of the lines and the Find Source dialog will
navigate to the directory where the Nvim source is (if you have it.)

</div>
<div class="help-para">
If you don't know how to debug this any further, follow the instructions
at ":help bug-report".  Paste the call stack into the bug report.

</div>
<div class="help-para">
From Visual Studio you can also try saving a minidump via the Debug menu and
send it with the bug report.  A minidump is a small file (&lt;100KB), which
contains information about the state of your process.

</div>
<div class="help-para">
<h2 id="_gdb" class="help-heading">Gdb<span class="help-heading-tags">                                                          <span id="dev-tools-gdb" class="help-tag"><a href="#dev-tools-gdb">dev-tools-gdb</a></span></h2>


</div>
<div class="help-para">
<h3 id="_using-gdb-to-step-through-functional-tests" class="help-heading">USING GDB TO STEP THROUGH FUNCTIONAL TESTS</h3>


</div>
<div class="help-para">
Use <code>TEST_TAG</code> to run tests matching busted tags (of the form <code>#foo</code> e.g.
<code>it("test #foo ...", ...)</code>):
<pre><code class="language-bash">GDB=1 TEST_TAG=foo make functionaltest</code></pre>

</div>
<div class="help-para">
Then, in another terminal:
<pre><code class="language-bash">gdb build/bin/nvim
(gdb) target remote localhost:7777</code></pre>
-- See <code>nvim_argv</code> in <a href="https://github.com/neovim/neovim/blob/master/test/functional/testnvim.lua">https://github.com/neovim/neovim/blob/master/test/functional/testnvim.lua</a>.

</div>
<div class="help-para">
<h3 id="_using-lldb-to-step-through-unit-tests" class="help-heading">USING LLDB TO STEP THROUGH UNIT TESTS</h3>


</div>
<div class="help-para">
<pre>lldb .deps/usr/bin/luajit -- .deps/usr/bin/busted --lpath="./build/?.lua" test/unit/</pre>

</div>
<div class="help-para">
<h3 id="_using-gdb" class="help-heading">USING GDB</h3>


</div>
<div class="help-para">
To attach to a running <code>nvim</code> process with a pid of 1234 (Tip: the pid of a
running Nvim instance can be obtained by calling <a href="vimfn.html#getpid()">getpid()</a>), for instance:
<pre><code class="language-bash">gdb -tui -p 1234 build/bin/nvim</code></pre>

</div>
<div class="help-para">
The <code>gdb</code> interactive prompt will appear. At any time you can:

</div>
<div class="help-para">
<div class="help-li" style=""> <code>break foo</code> to set a breakpoint on the <code>foo()</code> function
</div><div class="help-li" style=""> <code>n</code> to step over the next statement
</div><div class="help-li" style="margin-left: 3rem;"> <code>&lt;Enter&gt;</code> to repeat the last command
</div><div class="help-li" style=""> <code>s</code> to step into the next statement
</div><div class="help-li" style=""> <code>c</code> to continue
</div><div class="help-li" style=""> <code>finish</code> to step out of the current function
</div><div class="help-li" style=""> <code>p zub</code> to print the value of <code>zub</code>
</div><div class="help-li" style=""> <code>bt</code> to see a backtrace (callstack) from the current location
</div><div class="help-li" style=""> <code>CTRL-x CTRL-a</code> or <code>tui enable</code> to show a TUI view of the source file in the
  current debugging context. This can be extremely useful as it avoids the
  need for a gdb "frontend".
</div><div class="help-li" style=""> <code>&lt;up&gt;</code> and <code>&lt;down&gt;</code> to scroll the source file view
</div>
</div>
<div class="help-para">
<h3 id="_gdb-reverse-debugging" class="help-heading">GDB REVERSE DEBUGGING</h3>


</div>
<div class="help-para">
<div class="help-li" style=""> <code>set record full insn-number-max unlimited</code>
</div><div class="help-li" style=""> <code>continue</code> for a bit (at least until <code>main()</code> is executed
</div><div class="help-li" style=""> <code>record</code>
</div><div class="help-li" style=""> provoke the bug, then use <code>revert-next</code>, <code>reverse-step</code>, etc. to rewind the
  debugger
</div>
</div>
<div class="help-para">
<h3 id="_using-gdbserver" class="help-heading">USING GDBSERVER</h3>


</div>
<div class="help-para">
You may want to connect multiple <code>gdb</code> clients to the same running <code>nvim</code>
process, or you may want to connect to a remote <code>nvim</code> process with a local
<code>gdb</code>. Using <code>gdbserver</code>, you can attach to a single process and control it
from multiple <code>gdb</code> clients.

</div>
<div class="help-para">
Open a terminal and start <code>gdbserver</code> attached to <code>nvim</code> like this:
<pre><code class="language-bash">gdbserver :6666 build/bin/nvim 2&gt; gdbserver.log</code></pre>

</div>
<div class="help-para">
<code>gdbserver</code> is now listening on port 6666. You then need to attach to this
debugging session in another terminal:
<pre><code class="language-bash">gdb build/bin/nvim</code></pre>

</div>
<div class="help-para">
Once you've entered <code>gdb</code>, you need to attach to the remote session:
<pre>(gdb) target remote localhost:6666</pre>

</div>
<div class="help-para">
In case gdbserver puts the TUI as a background process, the TUI can become
unable to read input from pty (and receives SIGTTIN signal) and/or output data
(SIGTTOU signal). To force the TUI as the foreground process, you can add
<pre><code class="language-c">signal (SIGTTOU, SIG_IGN);
if (!tcsetpgrp(data-&gt;input.in_fd, getpid())) {
    perror("tcsetpgrp failed");
}</code></pre>

</div>
<div class="help-para">
to <code>tui.c:terminfo_start</code>.

</div>
<div class="help-para">
<h3 id="_using-gdbserver-in-tmux" class="help-heading">USING GDBSERVER IN TMUX</h3>


</div>
<div class="help-para">
Consider using a custom makefile
<a href="https://github.com/neovim/neovim/blob/master/BUILD.md#custom-makefile">https://github.com/neovim/neovim/blob/master/BUILD.md#custom-makefile</a> to
quickly start debugging sessions using the <code>gdbserver</code> method mentioned above.
This example <code>local.mk</code> will create the debugging session when you type
<code>make debug</code>.
<pre><code class="language-make">.PHONY: dbg-start dbg-attach debug build
build:
    @$(MAKE) nvim
dbg-start: build
    @tmux new-window -n 'dbg-neovim' 'gdbserver :6666 ./build/bin/nvim -D'
dbg-attach:
    @tmux new-window -n 'dbg-cgdb' 'cgdb -x gdb_start.sh ./build/bin/nvim'
debug: dbg-start dbg-attach</code></pre>

</div>
<div class="help-para">
Here <code>gdb_start.sh</code> includes <code>gdb</code> commands to be called when the debugger
starts. It needs to attach to the server started by the <code>dbg-start</code> rule. For
example:
<pre>(gdb) target remote localhost:6666
(gdb) br main</pre>

</div>
<div class="help-para">
<h2 id="_debugging-crashes-or-memory-leaks" class="help-heading">Debugging crashes or memory leaks<span class="help-heading-tags">                             <span id="dev-tools-asan" class="help-tag"><a href="#dev-tools-asan">dev-tools-asan</a></span></h2>


</div>
<div class="help-para">
<h3 id="_build-with-asan" class="help-heading">BUILD WITH ASAN</h3>


</div>
<div class="help-para">
Building Nvim with Clang sanitizers (Address Sanitizer: ASan, Undefined
Behavior Sanitizer: UBSan, Memory Sanitizer: MSan, Thread Sanitizer: TSan) is
a good way to catch undefined behavior, leaks and other errors as soon as they
happen.  It's significantly faster than Valgrind.

</div>
<div class="help-para">
Requires clang 3.4 or later, and <code>llvm-symbolizer</code> must be in <code>$PATH</code>:<pre>clang --version</pre>
Build Nvim with sanitizer instrumentation (choose one):<pre>CC=clang make CMAKE_EXTRA_FLAGS="-DENABLE_ASAN_UBSAN=ON"
CC=clang make CMAKE_EXTRA_FLAGS="-DENABLE_MSAN=ON"
CC=clang make CMAKE_EXTRA_FLAGS="-DENABLE_TSAN=ON"</pre>
Create a directory to store logs:<pre>mkdir -p "$HOME/logs"</pre>
Configure the sanitizer(s) via these environment variables:<pre># Change to detect_leaks=1 to detect memory leaks (slower, noisier).
export ASAN_OPTIONS="detect_leaks=0:log_path=$HOME/logs/asan"
# Show backtraces in the logs.
export MSAN_OPTIONS="log_path=${HOME}/logs/msan"
export TSAN_OPTIONS="log_path=${HOME}/logs/tsan"</pre>
Logs will be written to <code>${HOME}/logs/*san.PID</code> then.

</div>
<div class="help-para">
For more information: <a href="https://github.com/google/sanitizers/wiki/SanitizerCommonFlags">https://github.com/google/sanitizers/wiki/SanitizerCommonFlags</a>

</div>

  </div>
      <div class="col-narrow toc">
      <div><a href="index.html">Main</a></div>
      <div><a href="vimindex.html">Commands index</a></div>
      <div><a href="quickref.html">Quick reference</a></div>
      <hr/>
  <div class="help-toc-h1"><a href="#_logs">Logs</a>
</div><div class="help-toc-h1"><a href="#_reproducible-build">Reproducible build</a>
</div><div class="help-toc-h1"><a href="#_debug-tui">Debug TUI</a>
<div class="help-toc-h2"><a href="#_tui-inspect">TUI INSPECT</a></div>
<div class="help-toc-h2"><a href="#_terminfo-logging">TERMINFO LOGGING</a></div>
<div class="help-toc-h2"><a href="#_tui-debugging-with-gdb-lldb">TUI DEBUGGING WITH GDB LLDB</a></div>
<div class="help-toc-h2"><a href="#_tui-redraw">TUI REDRAW</a></div>
<div class="help-toc-h2"><a href="#_tui-trace">TUI TRACE</a></div>
<div class="help-toc-h2"><a href="#_terminal-reference">TERMINAL REFERENCE</a></div>
</div><div class="help-toc-h1"><a href="#_debug-performance">Debug Performance</a>
<div class="help-toc-h2"><a href="#_profiling-(easy)">PROFILING (EASY)</a></div>
<div class="help-toc-h2"><a href="#_profiling-(fancy)">PROFILING (FANCY)</a></div>
<div class="help-toc-h2"><a href="#_usdt-profiling-(powerful)">USDT PROFILING (POWERFUL)</a></div>
</div><div class="help-toc-h1"><a href="#_backtraces">Backtraces</a>
<div class="help-toc-h2"><a href="#_linux">LINUX</a></div>
<div class="help-toc-h2"><a href="#_macos">MACOS</a></div>
<div class="help-toc-h2"><a href="#_windows">WINDOWS</a></div>
</div><div class="help-toc-h1"><a href="#_gdb">Gdb</a>
<div class="help-toc-h2"><a href="#_using-gdb-to-step-through-functional-tests">USING GDB TO STEP THROUGH FUNCTIONAL TESTS</a></div>
<div class="help-toc-h2"><a href="#_using-lldb-to-step-through-unit-tests">USING LLDB TO STEP THROUGH UNIT TESTS</a></div>
<div class="help-toc-h2"><a href="#_using-gdb">USING GDB</a></div>
<div class="help-toc-h2"><a href="#_gdb-reverse-debugging">GDB REVERSE DEBUGGING</a></div>
<div class="help-toc-h2"><a href="#_using-gdbserver">USING GDBSERVER</a></div>
<div class="help-toc-h2"><a href="#_using-gdbserver-in-tmux">USING GDBSERVER IN TMUX</a></div>
</div><div class="help-toc-h1"><a href="#_debugging-crashes-or-memory-leaks">Debugging crashes or memory leaks</a>
<div class="help-toc-h2"><a href="#_build-with-asan">BUILD WITH ASAN</a></div>
</div></div>
</div>
  <footer>
    <div class="container flex">
      <div class="generator-stats">
        Generated at 2025-10-24 05:32 from <code><a href="https://github.com/neovim/neovim/commit/095b9f98f3e37b53520c766a12cb413dd0589028">095b9f9</a></code>
      </div>
      <div class="generator-stats">
      parse_errors: 0 (<a href="https://github.com/neovim/neovim/issues/new?labels=bug&title=user+docs+HTML%3A+dev_tools.txt+&body=%60gen_help_html.lua%60+problem+at%3A+https://neovim.io/doc/user/dev_tools.html%0D%0DContext%3A%0D%0D%60%60%60%0DTODO%0D%60%60%60" target="_blank">report docs bug...</a>) | <span title="          Nvim
                            NVIM REFERENCE MANUAL
                                  Type &lt;a href="various.html#gO"&gt;gO&lt;/a&gt; to see the table of contents.">noise_lines: 3</span>
      </div>
    <div>
  </footer>
  </body>
</html>
